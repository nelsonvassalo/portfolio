<script>
	import { json } from '@sveltejs/kit';
	import { onMount } from 'svelte';
	import A from './AnimatedWord.svelte';
	let song;
	export let div;

	async function getNowPlaying() {
		song = await fetch('/song/last_played').then((res) => {
			return res.json();
		});
	}

	onMount(async () => {
		getNowPlaying();
	});
</script>

<div bind:this={div}>
	<svg width="24" height="27" viewBox="0 0 24 27" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path
			d="M1.02876 16.505C0.742268 16.505 0.499186 16.4016 0.299512 16.1948C0.0998372 15.988 0 15.7425 0 15.4581V11.5419C0 11.2575 0.0998372 11.012 0.299512 10.8052C0.499186 10.5898 0.742268 10.482 1.02876 10.482C1.33261 10.482 1.58437 10.5898 1.78405 10.8052C1.9924 11.012 2.09658 11.2575 2.09658 11.5419V15.4581C2.09658 15.7425 1.9924 15.988 1.78405 16.1948C1.58437 16.4016 1.33261 16.505 1.02876 16.505ZM5.41725 21.7913C5.12208 21.7913 4.87466 21.6922 4.67499 21.494C4.47531 21.2872 4.37547 21.0373 4.37547 20.7444V6.25562C4.37547 5.96266 4.47531 5.71278 4.67499 5.50598C4.87466 5.29919 5.12208 5.19579 5.41725 5.19579C5.72111 5.19579 5.97287 5.29919 6.17254 5.50598C6.37222 5.71278 6.47206 5.96266 6.47206 6.25562V20.7444C6.47206 21.0373 6.37222 21.2872 6.17254 21.494C5.97287 21.6922 5.72111 21.7913 5.41725 21.7913ZM9.79273 27C9.49756 27 9.25014 26.8966 9.05046 26.6898C8.85947 26.4916 8.76397 26.2461 8.76397 25.9531V1.04691C8.76397 0.753949 8.85947 0.508377 9.05046 0.310196C9.25014 0.103399 9.49756 0 9.79273 0C10.0966 0 10.3483 0.103399 10.548 0.310196C10.7564 0.508377 10.8606 0.753949 10.8606 1.04691V25.9531C10.8606 26.2461 10.7564 26.4916 10.548 26.6898C10.3483 26.8966 10.0966 27 9.79273 27ZM14.1812 20.2145C13.8861 20.2145 13.6386 20.1154 13.439 19.9172C13.2393 19.719 13.1394 19.4734 13.1394 19.1805V7.81953C13.1394 7.52657 13.2393 7.281 13.439 7.08281C13.6386 6.87602 13.8861 6.77262 14.1812 6.77262C14.4764 6.77262 14.7238 6.87602 14.9235 7.08281C15.1318 7.281 15.236 7.52657 15.236 7.81953V19.1805C15.236 19.4734 15.1318 19.719 14.9235 19.9172C14.7238 20.1154 14.4764 20.2145 14.1812 20.2145ZM18.5697 24.1307C18.2659 24.1307 18.0141 24.0273 17.8144 23.8205C17.6148 23.6223 17.5149 23.381 17.5149 23.0967V3.9033C17.5149 3.61896 17.6148 3.37338 17.8144 3.16659C18.0141 2.95979 18.2659 2.85639 18.5697 2.85639C18.8649 2.85639 19.1123 2.95979 19.312 3.16659C19.5117 3.37338 19.6115 3.61896 19.6115 3.9033V23.0967C19.6115 23.381 19.5117 23.6223 19.312 23.8205C19.1123 24.0273 18.8649 24.1307 18.5697 24.1307ZM22.9452 17.6166C22.6413 17.6166 22.3896 17.5175 22.1899 17.3193C21.9989 17.1125 21.9034 16.8669 21.9034 16.5826V10.4174C21.9034 10.1331 21.9989 9.88751 22.1899 9.68071C22.3896 9.47391 22.6413 9.37051 22.9452 9.37051C23.2404 9.37051 23.4878 9.47391 23.6875 9.68071C23.8958 9.88751 24 10.1331 24 10.4174V16.5826C24 16.8669 23.8958 17.1125 23.6875 17.3193C23.4878 17.5175 23.2404 17.6166 22.9452 17.6166Z"
			fill="black"
		/>
	</svg>
	{#if song}
		<a href={song.track.external_urls.spotify} target="_blank">
			{song.track?.name},
			{#each song.track?.artists as artist, i}
				{artist.name}{#if i < song.track.artists.length - 1},&nbsp; {/if}
			{/each}
		</a>
	{/if}
</div>

<style lang="scss">
	div {
		display: flex;
		width: 100%;

		align-items: center;
		justify-content: flex-end;

		svg {
			margin-right: 1em;
		}
		a {
			text-decoration: none;
			color: #000;
			font-weight: 600;
			letter-spacing: -0.03em;
			overflow: hidden;
			text-overflow: ellipsis;
			height: 1lh;
			// white-space: nowrap;
		}
	}
</style>
